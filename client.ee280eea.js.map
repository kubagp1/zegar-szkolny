{"version":3,"sources":["client/timetable/validation.ts","client/timetable/index.ts","client/dom/index.ts","client/info/index.ts","../node_modules/penpal/lib/enums.js","../node_modules/penpal/lib/createDestructor.js","../node_modules/penpal/lib/createLogger.js","../node_modules/penpal/lib/parent/getOriginFromSrc.js","../node_modules/penpal/lib/errorSerialization.js","../node_modules/penpal/lib/connectCallReceiver.js","../node_modules/penpal/lib/generateId.js","../node_modules/penpal/lib/methodSerialization.js","../node_modules/penpal/lib/connectCallSender.js","../node_modules/penpal/lib/parent/handleAckMessageFactory.js","../node_modules/penpal/lib/parent/handleSynMessageFactory.js","../node_modules/penpal/lib/parent/monitorIframeRemoval.js","../node_modules/penpal/lib/startConnectionTimeout.js","../node_modules/penpal/lib/parent/validateIframeHasSrcOrSrcDoc.js","../node_modules/penpal/lib/parent/connectToChild.js","../node_modules/penpal/lib/child/handleSynAckMessageFactory.js","../node_modules/penpal/lib/child/connectToParent.js","../node_modules/penpal/lib/index.js","../node_modules/dotty/lib/index.js","client/config/Setting.ts","client/config/settings.ts","client/config/default.json","client/config/index.ts","client/autoupdater/currentVersion.json","client/autoupdater/index.ts","client/App.ts","client/index.ts"],"names":["MessageType","Resolution","ErrorCode","NativeErrorName","NativeEventType","localName","log","callbacks","destroyed","destroy","error","forEach","callback","onDestroy","push","debug","args","console","DEFAULT_PORT_BY_PROTOCOL","URL_REGEX","opaqueOriginSchemes","src","find","scheme","startsWith","location","protocol","hostname","port","document","regexResult","exec","portSuffix","serializeError","name","message","stack","deserializeError","obj","deserializedError","Error","Object","keys","key","info","serializedMethods","local","remote","originForSending","originForReceiving","handleMessageEvent","event","source","data","penpal","Call","origin","callMessage","methodName","id","createPromiseHandler","resolution","returnValue","Reply","Rejected","returnValueIsError","postMessage","err","DataCloneError","errorReplyMessage","Promise","resolve","apply","then","Fulfilled","addEventListener","Message","removeEventListener","KEY_PATH_DELIMITER","keyPathToSegments","keyPath","split","segmentsToKeyPath","segments","join","createKeyPath","prefix","setAtKeyPath","subject","value","reduce","prevSubject","idx","length","serializeMethods","methods","flattenedMethods","assign","deserializeMethods","callSender","methodKeyPaths","destroyConnection","createMethodProxy","api","iframeRemoved","closed","e","code","ConnectionDestroyed","reject","replyMessage","childOrigin","destructor","destroyCallReceiver","receiverMethodNames","window","receiverMethodName","methodNames","destroyCallSender","synAckMessage","SynAck","CHECK_IFRAME_IN_DOC_INTERVAL","iframe","checkIframeInDocIntervalId","setInterval","isConnected","clearInterval","timeout","timeoutId","undefined","setTimeout","ConnectionTimeout","clearTimeout","srcdoc","NoIframeSrc","options","handleSynMessage","handleAckMessage","promise","stopConnectionTimeout","handleMessage","contentWindow","Syn","Ack","parentOrigin","RegExp","test","ackMessage","parent","areGlobalsAccessible","handleSynAckMessage","synMessage","parentOriginForSyn","sendSynMessage","module","exports","showLogoOnStartup","timeOffset","colors","default","clock","background","progressBackground","progressFilled","progressTip","alternative","appearance","showProgressBar","showProgressBarTip","displayOffsetedTime","currentVersion"],"mappings":"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","file":"client.ee280eea.js","sourceRoot":"../src","sourcesContent":["import { Lesson, LessonPart } from '.'\n\nfunction convertTimetableToRelative(timetable: LessonPart[]): LessonPart[] {\n  const firstLessonStart = timetable[0].start\n\n  var relativeTimetable: LessonPart[] = []\n  for (const lesson of timetable) {\n    var relativeStart: number\n    if (lesson.start >= firstLessonStart) {\n      relativeStart = lesson.start - firstLessonStart\n    } else {\n      relativeStart = lesson.start + (86400 - firstLessonStart)\n    }\n\n    var relativeEnd: number\n    if (lesson.end >= firstLessonStart) {\n      relativeEnd = lesson.end - firstLessonStart\n    } else {\n      relativeEnd = lesson.end + (86400 - firstLessonStart)\n    }\n\n    relativeTimetable.push({\n      start: relativeStart,\n      end: relativeEnd\n    })\n  }\n\n  return relativeTimetable\n}\n\n/** Validates absolute timetable and returns full timetable. */\nexport function constructTimetable(unvalidatedTimetable: any[]): Lesson[] {\n  var validatedTimetable: LessonPart[] = []\n\n  // validate, that every entry is possible (0:00 > x > 24:00)\n  for (const lesson of unvalidatedTimetable) {\n    if (\n      typeof lesson?.start == 'number' &&\n      lesson.start <= 86400 &&\n      lesson.start >= 0 &&\n      typeof lesson?.end == 'number' &&\n      lesson.end <= 86400 &&\n      lesson.end >= 0\n    ) {\n      validatedTimetable.push({\n        start: lesson.start,\n        end: lesson.end\n      })\n    } else {\n      throw Error('The timetable has an incorrect entry.')\n    }\n  }\n\n  const sortedTimetable = validatedTimetable.sort((a, b) => a.start - b.start)\n\n  const relativeTimetable = convertTimetableToRelative(sortedTimetable)\n\n  // validate, that there are no intersecting lessons\n  for (let i = 1; i < relativeTimetable.length; i++) {\n    if (relativeTimetable[i].start < relativeTimetable[i - 1].end) {\n      throw Error('Overlapping lessons are present in the timetable.')\n    }\n  }\n\n  // validate, that every lesson starts before it ends\n  for (const lesson of relativeTimetable) {\n    if (lesson.start > lesson.end) {\n      throw Error('Lesson in the timetable starts before it ends.')\n    }\n  }\n\n  // combine and return relative and absolute\n  return relativeTimetable.map((relativeLesson, i) => {\n    return {\n      relativeStart: relativeLesson.start,\n      relativeEnd: relativeLesson.end,\n      absoluteStart: sortedTimetable[i].start,\n      absoluteEnd: sortedTimetable[i].end\n    }\n  })\n}\n","import { constructTimetable } from './validation'\n\nconst DEFAULT_TIMETABLE = [\n  { start: 25800, end: 28500 },\n  { start: 28800, end: 31500 },\n  { start: 32100, end: 34800 },\n  { start: 35400, end: 38100 },\n  { start: 39300, end: 42000 },\n  { start: 42600, end: 45300 },\n  { start: 45900, end: 48600 },\n  { start: 49200, end: 51900 },\n  { start: 52200, end: 54900 },\n  { start: 55200, end: 57900 },\n  { start: 58200, end: 60900 },\n  { start: 61200, end: 63900 },\n  { start: 64200, end: 66900 }\n]\n\nexport interface LessonPart {\n  start: number\n  end: number\n}\n\nexport interface Lesson {\n  relativeStart: number\n  relativeEnd: number\n  absoluteStart: number\n  absoluteEnd: number\n}\n\ninterface Timetable {\n  lessons: Lesson[]\n}\n\nclass Timetable {\n  constructor() {\n    try {\n      this.lessons = this.loadFromStorage()\n    } catch (error) {\n      console.error(error)\n\n      this.restoreDeafultTimetable()\n    }\n  }\n\n  public restoreDeafultTimetable() {\n    this.lessons = constructTimetable(DEFAULT_TIMETABLE)\n  }\n\n  private loadFromStorage(): Lesson[] {\n    const timetableJSON = localStorage.getItem('timetable')\n\n    if (typeof timetableJSON == 'string') {\n      const unvalidatedTimetable = JSON.parse(timetableJSON)\n\n      if (!Array.isArray(unvalidatedTimetable)) {\n        throw Error('Timetable from localStorage is not an array.')\n      }\n\n      var lessons = constructTimetable(unvalidatedTimetable)\n    } else throw Error('Failed to load timetable from localStorage.')\n\n    return lessons\n  }\n\n  public load(lessons: LessonPart[]) {\n    this.lessons = constructTimetable(lessons)\n    this.saveToStorage()\n  }\n\n  public saveToStorage() {\n    localStorage.setItem('timetable', JSON.stringify(this.lessons.map(lesson => ({\n      start: lesson.absoluteStart,\n      end: lesson.absoluteEnd\n    }))))\n  }\n\n  private getRelativeTime(seconds: number) {\n    seconds = seconds % 86400\n\n    const firstLesson = this.lessons[0]\n\n    if (seconds < firstLesson.absoluteStart)\n      return 86400 - firstLesson.absoluteStart + seconds\n    else return seconds - firstLesson.absoluteStart\n  }\n\n  private getLatestLesson(seconds: number): Lesson {\n    var latestLesson = this.lessons[this.lessons.length - 1] // Loop below depends on next lesson to detect latest lesson, so this is necessary.\n    for (let i = 0; i < this.lessons.length; i++) {\n      const testedLesson = this.lessons[i]\n\n      if (seconds < testedLesson.relativeStart) {\n        // Lessons are sorted from first to last.\n        latestLesson = this.lessons[i - 1]\n        break\n      }\n    }\n\n    return latestLesson\n  }\n\n  private getNextLesson(seconds: number): Lesson {\n    var nextLesson = this.lessons[0] // Midnight fix\n    for (let i = 1; i < this.lessons.length; i++) {\n      const testedLesson = this.lessons[i]\n\n      if (seconds < testedLesson.relativeStart) {\n        nextLesson = testedLesson\n        break\n      }\n    }\n\n    return nextLesson\n  }\n\n  public onBreak(absoluteSeconds: number): boolean {\n    const seconds = this.getRelativeTime(absoluteSeconds)\n\n    return seconds > this.getLatestLesson(seconds).relativeEnd\n  }\n\n  public onLesson(absoluteSeconds: number): boolean {\n    return !this.onBreak(absoluteSeconds)\n  }\n\n  /** Returns number between 0..1 that indicates progress in current lesson or break */\n  public getProgress(absoluteSeconds: number): number {\n    const seconds = this.getRelativeTime(absoluteSeconds)\n\n    const latestLesson = this.getLatestLesson(seconds)\n\n    if (this.onBreak(absoluteSeconds)) {\n      const nextLesson = this.getNextLesson(seconds)\n\n      if (nextLesson.relativeStart != 0) {\n        var breakLength = nextLesson.relativeStart - latestLesson.relativeEnd\n      } else {\n        // if the last relative break (end of school day)\n        var breakLength = 86400 - latestLesson.relativeEnd\n      }\n\n      return (seconds - latestLesson.relativeEnd) / breakLength\n    } else {\n      const lessonLength = latestLesson.relativeEnd - latestLesson.relativeStart\n\n      return (seconds - latestLesson.relativeStart) / lessonLength\n    }\n  }\n\n  public secondsSinceLessonStart(absoluteSeconds: number) {\n    const seconds = this.getRelativeTime(absoluteSeconds)\n\n    if (this.onBreak(absoluteSeconds)) {\n      console.warn('secondsFromLessonBeggining used on break!')\n    }\n\n    const latestLesson = this.getLatestLesson(seconds)\n\n    return seconds - latestLesson.relativeStart\n  }\n\n  public secondsToNextLessonStart(absoluteSeconds: number) {\n    const seconds = this.getRelativeTime(absoluteSeconds)\n\n    if (this.onLesson(absoluteSeconds)) {\n      console.warn('secondsToNextLesson used on lesson!')\n    }\n\n    const nextLesson = this.getNextLesson(seconds)\n\n    if (nextLesson.relativeStart != 0) {\n      return nextLesson.relativeStart - seconds\n    } else {\n      // if the last relative break (end of school day)\n      return nextLesson.relativeStart + (86400 - seconds)\n    }\n  }\n\n  public secondsToEndOfLesson(absoluteSeconds: number) {\n    const seconds = this.getRelativeTime(absoluteSeconds)\n\n    if (this.onBreak(absoluteSeconds)) {\n      console.warn('secondsToEndOfLesson used on break!')\n    }\n\n    const latestLesson = this.getLatestLesson(seconds)\n\n    return latestLesson.relativeEnd - seconds\n  }\n}\n\nexport default Timetable\n","export interface DOMUpdate {\n  hours?: string | number\n  minutes?: string | number\n  progress?: number\n  info?: string\n  theme?: 'default' | 'alternative'\n}\n\nexport default class DOM {\n  private dom: {\n    clock: HTMLDivElement\n    hours: HTMLSpanElement\n    minutes: HTMLSpanElement\n    progressInfo: HTMLDivElement\n    progressBar: HTMLDivElement\n    fullscreenButton: HTMLSpanElement\n    preferencesButton: HTMLSpanElement\n    preferencesContainer: HTMLDivElement\n    iframe: HTMLIFrameElement\n  }\n\n  constructor() {\n    this.dom = {\n      clock: document.querySelector('.clock') as HTMLDivElement,\n      hours: document.querySelector('#hours') as HTMLSpanElement,\n      minutes: document.querySelector('#minutes') as HTMLSpanElement,\n      progressInfo: document.querySelector('.progress-info') as HTMLDivElement,\n      progressBar: document.querySelector('.progress-filled') as HTMLDivElement,\n      fullscreenButton: document.querySelector(\n        '#open-fullscreen'\n      ) as HTMLSpanElement,\n      preferencesButton: document.querySelector(\n        '#open-preferences'\n      ) as HTMLSpanElement,\n      preferencesContainer: document.querySelector(\n        '#preferences-container'\n      ) as HTMLDivElement,\n      iframe: document.querySelector('iframe#preferences') as HTMLIFrameElement\n    }\n\n    this.dom.fullscreenButton.addEventListener('click', () => {\n      document.documentElement.requestFullscreen()\n    })\n\n    let resizeHandler = () => {\n      if (window.innerHeight == screen.height) {\n        document.documentElement.classList.add('fullscreen')\n      } else {\n        document.documentElement.classList.remove('fullscreen')\n      }\n    }\n    window.addEventListener('resize', resizeHandler)\n    resizeHandler()\n\n    this.dom.preferencesButton.addEventListener('click', () => {\n      this.dom.preferencesContainer.classList.remove('d-none')\n    })\n\n    this.dom.preferencesContainer.addEventListener('click', (e) => {\n      if (e.target == this.dom.preferencesContainer)\n        this.dom.preferencesContainer.classList.add('d-none')\n    })\n\n    this.dom.iframe.addEventListener('load', () => {\n      setTimeout(() => {\n        this.dom.preferencesContainer.classList.add('d-none')\n        this.dom.preferencesContainer.classList.remove('invisible')\n      }, 200) // I have no idea why, but when you hide this immediately, it breaks topbar layout\n    })\n  }\n\n  public update(update: DOMUpdate): void {\n    if (update.hours !== undefined) {\n      this.dom.hours.innerText = update.hours.toString()\n    }\n\n    if (update.minutes !== undefined) {\n      this.dom.minutes.innerText = update.minutes.toString()\n    }\n\n    if (update.progress !== undefined) {\n      this.dom.progressBar.style.setProperty(\n        '--width',\n        `${(update.progress * 100).toString()}%`\n      )\n    }\n\n    if (update.info !== undefined) {\n      this.dom.progressInfo.innerText = update.info\n    }\n\n    if (update.theme !== undefined) {\n      setCSSVariable('clock-color', `var(--${update.theme}-clock-color)`)\n      setCSSVariable(\n        'background-color',\n        `var(--${update.theme}-background-color)`\n      )\n      setCSSVariable(\n        'progress-background-color',\n        `var(--${update.theme}-progress-background-color)`\n      )\n      setCSSVariable(\n        'progress-filled-color',\n        `var(--${update.theme}-progress-filled-color)`\n      )\n      setCSSVariable(\n        'progress-tip-color',\n        `var(--${update.theme}-progress-tip-color)`\n      )\n    }\n  }\n}\n\nfunction setCSSVariable(key: string, value: string) {\n  document.documentElement.style.setProperty(`--${key}`, value)\n}\n","import Timetable from '../timetable'\n\nconst HOURS_GRAMMAR: Grammar = {\n  singular: 'godzina',\n  plural: 'godziny',\n  pluralGenitive: 'godzin'\n}\n\nconst MINUTES_GRAMMAR: Grammar = {\n  singular: 'minuta',\n  plural: 'minuty',\n  pluralGenitive: 'minut'\n}\n\nconst SECONDS_GRAMMAR: Grammar = {\n  singular: 'sekunda',\n  plural: 'sekundy',\n  pluralGenitive: 'sekund'\n}\n\nconst END_GRAMMAR: Grammar = {\n  singular: 'a',\n  plural: 'y',\n  pluralGenitive: 'o'\n}\n\ninterface Grammar {\n  singular: string\n  plural: string\n  pluralGenitive: string\n}\n\nfunction grammar(n: number, grammar: Grammar): string {\n  n = Math.abs(n)\n  if (n == 1) return grammar.singular\n  if (n % 10 > 4 || n % 10 < 2 || (n % 100 < 15 && n % 100 > 11))\n    return grammar.pluralGenitive\n  return grammar.plural\n}\n\nexport default class Info {\n  constructor(private timetable: Timetable) {}\n\n  private humanizeTime(time: number): string {\n    const hours = parseInt(new Date(time * 1000).toISOString().substr(11, 2))\n    const minutes = parseInt(new Date(time * 1000).toISOString().substr(14, 2))\n    const seconds = parseInt(new Date(time * 1000).toISOString().substr(17, 2))\n\n    if (hours > 0 && minutes > 0)\n      return `${grammar(hours, END_GRAMMAR)} ${hours} ${grammar(\n        hours,\n        HOURS_GRAMMAR\n      )} i ${minutes} ${grammar(minutes, MINUTES_GRAMMAR)}`\n    else if (hours > 0 && seconds > 0)\n      return `${grammar(hours, END_GRAMMAR)} ${hours} ${grammar(\n        hours,\n        HOURS_GRAMMAR\n      )} i ${seconds} ${grammar(seconds, SECONDS_GRAMMAR)}`\n    else if (hours > 0)\n      return `${grammar(hours, END_GRAMMAR)} ${hours} ${grammar(\n        hours,\n        HOURS_GRAMMAR\n      )}`\n    else if (minutes > 0 && seconds > 0)\n      return `${grammar(minutes, END_GRAMMAR)} ${minutes} ${grammar(\n        minutes,\n        MINUTES_GRAMMAR\n      )} i ${seconds} ${grammar(seconds, SECONDS_GRAMMAR)}`\n    else if (minutes > 0)\n      return `${grammar(minutes, END_GRAMMAR)} ${minutes} ${grammar(\n        minutes,\n        MINUTES_GRAMMAR\n      )}`\n    else\n      return `${grammar(seconds, END_GRAMMAR)} ${seconds} ${grammar(\n        seconds,\n        SECONDS_GRAMMAR\n      )}`\n  }\n\n  private generateSinceLessonStart(time: number) {\n    return `Od początku lekcji minęł${this.humanizeTime(\n      this.timetable.secondsSinceLessonStart(time)\n    )}`\n  }\n\n  private generateToEndOfLesson(time: number) {\n    return `Do końca lekcji pozostał${this.humanizeTime(\n      this.timetable.secondsToEndOfLesson(time)\n    )}`\n  }\n\n  private generateToNextLessonStart(time: number) {\n    return `Do końca przerwy pozostał${this.humanizeTime(\n      this.timetable.secondsToNextLessonStart(time)\n    )}`\n  }\n\n  public generate(time: number): string {\n    if (this.timetable.onLesson(time)) {\n      if (this.timetable.getProgress(time) < 1 / 3) {\n        return this.generateSinceLessonStart(time)\n      } else {\n        return this.generateToEndOfLesson(time)\n      }\n    } else {\n      return this.generateToNextLessonStart(time)\n    }\n  }\n}\n","export var MessageType;\n(function (MessageType) {\n    MessageType[\"Call\"] = \"call\";\n    MessageType[\"Reply\"] = \"reply\";\n    MessageType[\"Syn\"] = \"syn\";\n    MessageType[\"SynAck\"] = \"synAck\";\n    MessageType[\"Ack\"] = \"ack\";\n})(MessageType || (MessageType = {}));\nexport var Resolution;\n(function (Resolution) {\n    Resolution[\"Fulfilled\"] = \"fulfilled\";\n    Resolution[\"Rejected\"] = \"rejected\";\n})(Resolution || (Resolution = {}));\nexport var ErrorCode;\n(function (ErrorCode) {\n    ErrorCode[\"ConnectionDestroyed\"] = \"ConnectionDestroyed\";\n    ErrorCode[\"ConnectionTimeout\"] = \"ConnectionTimeout\";\n    ErrorCode[\"NoIframeSrc\"] = \"NoIframeSrc\";\n})(ErrorCode || (ErrorCode = {}));\nexport var NativeErrorName;\n(function (NativeErrorName) {\n    NativeErrorName[\"DataCloneError\"] = \"DataCloneError\";\n})(NativeErrorName || (NativeErrorName = {}));\nexport var NativeEventType;\n(function (NativeEventType) {\n    NativeEventType[\"Message\"] = \"message\";\n})(NativeEventType || (NativeEventType = {}));\n","export default (localName, log) => {\n    const callbacks = [];\n    let destroyed = false;\n    return {\n        destroy(error) {\n            if (!destroyed) {\n                destroyed = true;\n                log(`${localName}: Destroying connection`);\n                callbacks.forEach((callback) => {\n                    callback(error);\n                });\n            }\n        },\n        onDestroy(callback) {\n            destroyed ? callback() : callbacks.push(callback);\n        },\n    };\n};\n","export default (debug) => {\n    /**\n     * Logs a message if debug is enabled.\n     */\n    return (...args) => {\n        if (debug) {\n            console.log('[Penpal]', ...args); // eslint-disable-line no-console\n        }\n    };\n};\n","const DEFAULT_PORT_BY_PROTOCOL = {\n    'http:': '80',\n    'https:': '443',\n};\nconst URL_REGEX = /^(https?:)?\\/\\/([^/:]+)?(:(\\d+))?/;\nconst opaqueOriginSchemes = ['file:', 'data:'];\n/**\n * Converts a src value into an origin.\n */\nexport default (src) => {\n    if (src && opaqueOriginSchemes.find((scheme) => src.startsWith(scheme))) {\n        // The origin of the child document is an opaque origin and its\n        // serialization is \"null\"\n        // https://html.spec.whatwg.org/multipage/origin.html#origin\n        return 'null';\n    }\n    // Note that if src is undefined, then srcdoc is being used instead of src\n    // and we can follow this same logic below to get the origin of the parent,\n    // which is the origin that we will need to use.\n    const location = document.location;\n    const regexResult = URL_REGEX.exec(src);\n    let protocol;\n    let hostname;\n    let port;\n    if (regexResult) {\n        // It's an absolute URL. Use the parsed info.\n        // regexResult[1] will be undefined if the URL starts with //\n        protocol = regexResult[1] ? regexResult[1] : location.protocol;\n        hostname = regexResult[2];\n        port = regexResult[4];\n    }\n    else {\n        // It's a relative path. Use the current location's info.\n        protocol = location.protocol;\n        hostname = location.hostname;\n        port = location.port;\n    }\n    // If the port is the default for the protocol, we don't want to add it to the origin string\n    // or it won't match the message's event.origin.\n    const portSuffix = port && port !== DEFAULT_PORT_BY_PROTOCOL[protocol] ? `:${port}` : '';\n    return `${protocol}//${hostname}${portSuffix}`;\n};\n","/**\n * Converts an error object into a plain object.\n */\nexport const serializeError = ({ name, message, stack, }) => ({\n    name,\n    message,\n    stack,\n});\n/**\n * Converts a plain object into an error object.\n */\nexport const deserializeError = (obj) => {\n    const deserializedError = new Error();\n    // @ts-ignore\n    Object.keys(obj).forEach((key) => (deserializedError[key] = obj[key]));\n    return deserializedError;\n};\n","import { serializeError } from './errorSerialization';\nimport { MessageType, NativeEventType, NativeErrorName, Resolution, } from './enums';\n/**\n * Listens for \"call\" messages coming from the remote, executes the corresponding method, and\n * responds with the return value.\n */\nexport default (info, serializedMethods, log) => {\n    const { localName, local, remote, originForSending, originForReceiving, } = info;\n    let destroyed = false;\n    const handleMessageEvent = (event) => {\n        if (event.source !== remote || event.data.penpal !== MessageType.Call) {\n            return;\n        }\n        if (event.origin !== originForReceiving) {\n            log(`${localName} received message from origin ${event.origin} which did not match expected origin ${originForReceiving}`);\n            return;\n        }\n        const callMessage = event.data;\n        const { methodName, args, id } = callMessage;\n        log(`${localName}: Received ${methodName}() call`);\n        const createPromiseHandler = (resolution) => {\n            return (returnValue) => {\n                log(`${localName}: Sending ${methodName}() reply`);\n                if (destroyed) {\n                    // It's possible to throw an error here, but it would need to be thrown asynchronously\n                    // and would only be catchable using window.onerror. This is because the consumer\n                    // is merely returning a value from their method and not calling any function\n                    // that they could wrap in a try-catch. Even if the consumer were to catch the error,\n                    // the value of doing so is questionable. Instead, we'll just log a message.\n                    log(`${localName}: Unable to send ${methodName}() reply due to destroyed connection`);\n                    return;\n                }\n                const message = {\n                    penpal: MessageType.Reply,\n                    id,\n                    resolution,\n                    returnValue,\n                };\n                if (resolution === Resolution.Rejected &&\n                    returnValue instanceof Error) {\n                    message.returnValue = serializeError(returnValue);\n                    message.returnValueIsError = true;\n                }\n                try {\n                    remote.postMessage(message, originForSending);\n                }\n                catch (err) {\n                    // If a consumer attempts to send an object that's not cloneable (e.g., window),\n                    // we want to ensure the receiver's promise gets rejected.\n                    if (err.name === NativeErrorName.DataCloneError) {\n                        const errorReplyMessage = {\n                            penpal: MessageType.Reply,\n                            id,\n                            resolution: Resolution.Rejected,\n                            returnValue: serializeError(err),\n                            returnValueIsError: true,\n                        };\n                        remote.postMessage(errorReplyMessage, originForSending);\n                    }\n                    throw err;\n                }\n            };\n        };\n        new Promise((resolve) => resolve(serializedMethods[methodName].apply(serializedMethods, args))).then(createPromiseHandler(Resolution.Fulfilled), createPromiseHandler(Resolution.Rejected));\n    };\n    local.addEventListener(NativeEventType.Message, handleMessageEvent);\n    return () => {\n        destroyed = true;\n        local.removeEventListener(NativeEventType.Message, handleMessageEvent);\n    };\n};\n","let id = 0;\n/**\n * @return {number} A unique ID (not universally unique)\n */\nexport default () => ++id;\n","const KEY_PATH_DELIMITER = '.';\nconst keyPathToSegments = (keyPath) => keyPath ? keyPath.split(KEY_PATH_DELIMITER) : [];\nconst segmentsToKeyPath = (segments) => segments.join(KEY_PATH_DELIMITER);\nconst createKeyPath = (key, prefix) => {\n    const segments = keyPathToSegments(prefix || '');\n    segments.push(key);\n    return segmentsToKeyPath(segments);\n};\n/**\n * Given a `keyPath`, set it to be `value` on `subject`, creating any intermediate\n * objects along the way.\n *\n * @param {Object} subject The object on which to set value.\n * @param {string} keyPath The key path at which to set value.\n * @param {Object} value The value to store at the given key path.\n * @returns {Object} Updated subject.\n */\nexport const setAtKeyPath = (subject, keyPath, value) => {\n    const segments = keyPathToSegments(keyPath);\n    segments.reduce((prevSubject, key, idx) => {\n        if (typeof prevSubject[key] === 'undefined') {\n            prevSubject[key] = {};\n        }\n        if (idx === segments.length - 1) {\n            prevSubject[key] = value;\n        }\n        return prevSubject[key];\n    }, subject);\n    return subject;\n};\n/**\n * Given a dictionary of (nested) keys to function, flatten them to a map\n * from key path to function.\n *\n * @param {Object} methods The (potentially nested) object to serialize.\n * @param {string} prefix A string with which to prefix entries. Typically not intended to be used by consumers.\n * @returns {Object} An map from key path in `methods` to functions.\n */\nexport const serializeMethods = (methods, prefix) => {\n    const flattenedMethods = {};\n    Object.keys(methods).forEach((key) => {\n        const value = methods[key];\n        const keyPath = createKeyPath(key, prefix);\n        if (typeof value === 'object') {\n            // Recurse into any nested children.\n            Object.assign(flattenedMethods, serializeMethods(value, keyPath));\n        }\n        if (typeof value === 'function') {\n            // If we've found a method, expose it.\n            flattenedMethods[keyPath] = value;\n        }\n    });\n    return flattenedMethods;\n};\n/**\n * Given a map of key paths to functions, unpack the key paths to an object.\n *\n * @param {Object} flattenedMethods A map of key paths to functions to unpack.\n * @returns {Object} A (potentially nested) map of functions.\n */\nexport const deserializeMethods = (flattenedMethods) => {\n    const methods = {};\n    for (const keyPath in flattenedMethods) {\n        setAtKeyPath(methods, keyPath, flattenedMethods[keyPath]);\n    }\n    return methods;\n};\n","import generateId from './generateId';\nimport { deserializeError } from './errorSerialization';\nimport { deserializeMethods } from './methodSerialization';\nimport { ErrorCode, MessageType, NativeEventType, Resolution } from './enums';\n/**\n * Augments an object with methods that match those defined by the remote. When these methods are\n * called, a \"call\" message will be sent to the remote, the remote's corresponding method will be\n * executed, and the method's return value will be returned via a message.\n * @param {Object} callSender Sender object that should be augmented with methods.\n * @param {Object} info Information about the local and remote windows.\n * @param {Array} methodKeyPaths Key paths of methods available to be called on the remote.\n * @param {Promise} destructionPromise A promise resolved when destroy() is called on the penpal\n * connection.\n * @returns {Object} The call sender object with methods that may be called.\n */\nexport default (callSender, info, methodKeyPaths, destroyConnection, log) => {\n    const { localName, local, remote, originForSending, originForReceiving, } = info;\n    let destroyed = false;\n    log(`${localName}: Connecting call sender`);\n    const createMethodProxy = (methodName) => {\n        return (...args) => {\n            log(`${localName}: Sending ${methodName}() call`);\n            // This handles the case where the iframe has been removed from the DOM\n            // (and therefore its window closed), the consumer has not yet\n            // called destroy(), and the user calls a method exposed by\n            // the remote. We detect the iframe has been removed and force\n            // a destroy() immediately so that the consumer sees the error saying\n            // the connection has been destroyed. We wrap this check in a try catch\n            // because Edge throws an \"Object expected\" error when accessing\n            // contentWindow.closed on a contentWindow from an iframe that's been\n            // removed from the DOM.\n            let iframeRemoved;\n            try {\n                if (remote.closed) {\n                    iframeRemoved = true;\n                }\n            }\n            catch (e) {\n                iframeRemoved = true;\n            }\n            if (iframeRemoved) {\n                destroyConnection();\n            }\n            if (destroyed) {\n                const error = new Error(`Unable to send ${methodName}() call due ` + `to destroyed connection`);\n                error.code = ErrorCode.ConnectionDestroyed;\n                throw error;\n            }\n            return new Promise((resolve, reject) => {\n                const id = generateId();\n                const handleMessageEvent = (event) => {\n                    if (event.source !== remote ||\n                        event.data.penpal !== MessageType.Reply ||\n                        event.data.id !== id) {\n                        return;\n                    }\n                    if (event.origin !== originForReceiving) {\n                        log(`${localName} received message from origin ${event.origin} which did not match expected origin ${originForReceiving}`);\n                        return;\n                    }\n                    const replyMessage = event.data;\n                    log(`${localName}: Received ${methodName}() reply`);\n                    local.removeEventListener(NativeEventType.Message, handleMessageEvent);\n                    let returnValue = replyMessage.returnValue;\n                    if (replyMessage.returnValueIsError) {\n                        returnValue = deserializeError(returnValue);\n                    }\n                    (replyMessage.resolution === Resolution.Fulfilled ? resolve : reject)(returnValue);\n                };\n                local.addEventListener(NativeEventType.Message, handleMessageEvent);\n                const callMessage = {\n                    penpal: MessageType.Call,\n                    id,\n                    methodName,\n                    args,\n                };\n                remote.postMessage(callMessage, originForSending);\n            });\n        };\n    };\n    // Wrap each method in a proxy which sends it to the corresponding receiver.\n    const flattenedMethods = methodKeyPaths.reduce((api, name) => {\n        api[name] = createMethodProxy(name);\n        return api;\n    }, {});\n    // Unpack the structure of the provided methods object onto the CallSender, exposing\n    // the methods in the same shape they were provided.\n    Object.assign(callSender, deserializeMethods(flattenedMethods));\n    return () => {\n        destroyed = true;\n    };\n};\n","import connectCallReceiver from '../connectCallReceiver';\nimport connectCallSender from '../connectCallSender';\n/**\n * Handles an ACK handshake message.\n */\nexport default (serializedMethods, childOrigin, originForSending, destructor, log) => {\n    const { destroy, onDestroy } = destructor;\n    let destroyCallReceiver;\n    let receiverMethodNames;\n    // We resolve the promise with the call sender. If the child reconnects\n    // (for example, after refreshing or navigating to another page that\n    // uses Penpal, we'll update the call sender with methods that match the\n    // latest provided by the child.\n    const callSender = {};\n    return (event) => {\n        if (event.origin !== childOrigin) {\n            log(`Parent: Handshake - Received ACK message from origin ${event.origin} which did not match expected origin ${childOrigin}`);\n            return;\n        }\n        log('Parent: Handshake - Received ACK');\n        const info = {\n            localName: 'Parent',\n            local: window,\n            remote: event.source,\n            originForSending: originForSending,\n            originForReceiving: childOrigin,\n        };\n        // If the child reconnected, we need to destroy the prior call receiver\n        // before setting up a new one.\n        if (destroyCallReceiver) {\n            destroyCallReceiver();\n        }\n        destroyCallReceiver = connectCallReceiver(info, serializedMethods, log);\n        onDestroy(destroyCallReceiver);\n        // If the child reconnected, we need to remove the methods from the\n        // previous call receiver off the sender.\n        if (receiverMethodNames) {\n            receiverMethodNames.forEach((receiverMethodName) => {\n                delete callSender[receiverMethodName];\n            });\n        }\n        receiverMethodNames = event.data.methodNames;\n        const destroyCallSender = connectCallSender(callSender, info, receiverMethodNames, destroy, log);\n        onDestroy(destroyCallSender);\n        return callSender;\n    };\n};\n","import { MessageType } from '../enums';\n/**\n * Handles a SYN handshake message.\n */\nexport default (log, serializedMethods, childOrigin, originForSending) => {\n    return (event) => {\n        if (event.origin !== childOrigin) {\n            log(`Parent: Handshake - Received SYN message from origin ${event.origin} which did not match expected origin ${childOrigin}`);\n            return;\n        }\n        log('Parent: Handshake - Received SYN, responding with SYN-ACK');\n        const synAckMessage = {\n            penpal: MessageType.SynAck,\n            methodNames: Object.keys(serializedMethods),\n        };\n        event.source.postMessage(synAckMessage, originForSending);\n    };\n};\n","const CHECK_IFRAME_IN_DOC_INTERVAL = 60000;\n/**\n * Monitors for iframe removal and destroys connection if iframe\n * is found to have been removed from DOM. This is to prevent memory\n * leaks when the iframe is removed from the document and the consumer\n * hasn't called destroy(). Without this, event listeners attached to\n * the window would stick around and since the event handlers have a\n * reference to the iframe in their closures, the iframe would stick\n * around too.\n */\nexport default (iframe, destructor) => {\n    const { destroy, onDestroy } = destructor;\n    const checkIframeInDocIntervalId = setInterval(() => {\n        if (!iframe.isConnected) {\n            clearInterval(checkIframeInDocIntervalId);\n            destroy();\n        }\n    }, CHECK_IFRAME_IN_DOC_INTERVAL);\n    onDestroy(() => {\n        clearInterval(checkIframeInDocIntervalId);\n    });\n};\n","import { ErrorCode } from './enums';\n/**\n * Starts a timeout and calls the callback with an error\n * if the timeout completes before the stop function is called.\n */\nexport default (timeout, callback) => {\n    let timeoutId;\n    if (timeout !== undefined) {\n        timeoutId = window.setTimeout(() => {\n            const error = new Error(`Connection timed out after ${timeout}ms`);\n            error.code = ErrorCode.ConnectionTimeout;\n            callback(error);\n        }, timeout);\n    }\n    return () => {\n        clearTimeout(timeoutId);\n    };\n};\n","import { ErrorCode } from '../enums';\nexport default (iframe) => {\n    if (!iframe.src && !iframe.srcdoc) {\n        const error = new Error('Iframe must have src or srcdoc property defined.');\n        error.code = ErrorCode.NoIframeSrc;\n        throw error;\n    }\n};\n","import { MessageType, NativeEventType } from '../enums';\nimport createDestructor from '../createDestructor';\nimport createLogger from '../createLogger';\nimport getOriginFromSrc from './getOriginFromSrc';\nimport handleAckMessageFactory from './handleAckMessageFactory';\nimport handleSynMessageFactory from './handleSynMessageFactory';\nimport { serializeMethods } from '../methodSerialization';\nimport monitorIframeRemoval from './monitorIframeRemoval';\nimport startConnectionTimeout from '../startConnectionTimeout';\nimport validateIframeHasSrcOrSrcDoc from './validateIframeHasSrcOrSrcDoc';\n/**\n * Attempts to establish communication with an iframe.\n */\nexport default (options) => {\n    let { iframe, methods = {}, childOrigin, timeout, debug = false } = options;\n    const log = createLogger(debug);\n    const destructor = createDestructor('Parent', log);\n    const { onDestroy, destroy } = destructor;\n    if (!childOrigin) {\n        validateIframeHasSrcOrSrcDoc(iframe);\n        childOrigin = getOriginFromSrc(iframe.src);\n    }\n    // If event.origin is \"null\", the remote protocol is file: or data: and we\n    // must post messages with \"*\" as targetOrigin when sending messages.\n    // https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage#Using_window.postMessage_in_extensions\n    const originForSending = childOrigin === 'null' ? '*' : childOrigin;\n    const serializedMethods = serializeMethods(methods);\n    const handleSynMessage = handleSynMessageFactory(log, serializedMethods, childOrigin, originForSending);\n    const handleAckMessage = handleAckMessageFactory(serializedMethods, childOrigin, originForSending, destructor, log);\n    const promise = new Promise((resolve, reject) => {\n        const stopConnectionTimeout = startConnectionTimeout(timeout, destroy);\n        const handleMessage = (event) => {\n            if (event.source !== iframe.contentWindow || !event.data) {\n                return;\n            }\n            if (event.data.penpal === MessageType.Syn) {\n                handleSynMessage(event);\n                return;\n            }\n            if (event.data.penpal === MessageType.Ack) {\n                const callSender = handleAckMessage(event);\n                if (callSender) {\n                    stopConnectionTimeout();\n                    resolve(callSender);\n                }\n                return;\n            }\n        };\n        window.addEventListener(NativeEventType.Message, handleMessage);\n        log('Parent: Awaiting handshake');\n        monitorIframeRemoval(iframe, destructor);\n        onDestroy((error) => {\n            window.removeEventListener(NativeEventType.Message, handleMessage);\n            if (error) {\n                reject(error);\n            }\n        });\n    });\n    return {\n        promise,\n        destroy() {\n            // Don't allow consumer to pass an error into destroy.\n            destroy();\n        },\n    };\n};\n","import { MessageType } from '../enums';\nimport connectCallReceiver from '../connectCallReceiver';\nimport connectCallSender from '../connectCallSender';\n/**\n * Handles a SYN-ACK handshake message.\n */\nexport default (parentOrigin, serializedMethods, destructor, log) => {\n    const { destroy, onDestroy } = destructor;\n    return (event) => {\n        let originQualifies = parentOrigin instanceof RegExp\n            ? parentOrigin.test(event.origin)\n            : parentOrigin === '*' || parentOrigin === event.origin;\n        if (!originQualifies) {\n            log(`Child: Handshake - Received SYN-ACK from origin ${event.origin} which did not match expected origin ${parentOrigin}`);\n            return;\n        }\n        log('Child: Handshake - Received SYN-ACK, responding with ACK');\n        // If event.origin is \"null\", the remote protocol is file: or data: and we\n        // must post messages with \"*\" as targetOrigin when sending messages.\n        // https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage#Using_window.postMessage_in_extensions\n        const originForSending = event.origin === 'null' ? '*' : event.origin;\n        const ackMessage = {\n            penpal: MessageType.Ack,\n            methodNames: Object.keys(serializedMethods),\n        };\n        window.parent.postMessage(ackMessage, originForSending);\n        const info = {\n            localName: 'Child',\n            local: window,\n            remote: window.parent,\n            originForSending,\n            originForReceiving: event.origin,\n        };\n        const destroyCallReceiver = connectCallReceiver(info, serializedMethods, log);\n        onDestroy(destroyCallReceiver);\n        const callSender = {};\n        const destroyCallSender = connectCallSender(callSender, info, event.data.methodNames, destroy, log);\n        onDestroy(destroyCallSender);\n        return callSender;\n    };\n};\n","import createDestructor from '../createDestructor';\nimport createLogger from '../createLogger';\nimport { MessageType, NativeEventType } from '../enums';\nimport handleSynAckMessageFactory from './handleSynAckMessageFactory';\nimport { serializeMethods } from '../methodSerialization';\nimport startConnectionTimeout from '../startConnectionTimeout';\nconst areGlobalsAccessible = () => {\n    try {\n        clearTimeout();\n    }\n    catch (e) {\n        return false;\n    }\n    return true;\n};\n/**\n * Attempts to establish communication with the parent window.\n */\nexport default (options = {}) => {\n    const { parentOrigin = '*', methods = {}, timeout, debug = false } = options;\n    const log = createLogger(debug);\n    const destructor = createDestructor('Child', log);\n    const { destroy, onDestroy } = destructor;\n    const serializedMethods = serializeMethods(methods);\n    const handleSynAckMessage = handleSynAckMessageFactory(parentOrigin, serializedMethods, destructor, log);\n    const sendSynMessage = () => {\n        log('Child: Handshake - Sending SYN');\n        const synMessage = { penpal: MessageType.Syn };\n        const parentOriginForSyn = parentOrigin instanceof RegExp ? '*' : parentOrigin;\n        window.parent.postMessage(synMessage, parentOriginForSyn);\n    };\n    const promise = new Promise((resolve, reject) => {\n        const stopConnectionTimeout = startConnectionTimeout(timeout, destroy);\n        const handleMessage = (event) => {\n            // Under niche scenarios, we get into this function after\n            // the iframe has been removed from the DOM. In Edge, this\n            // results in \"Object expected\" errors being thrown when we\n            // try to access properties on window (global properties).\n            // For this reason, we try to access a global up front (clearTimeout)\n            // and if it fails we can assume the iframe has been removed\n            // and we ignore the message event.\n            if (!areGlobalsAccessible()) {\n                return;\n            }\n            if (event.source !== parent || !event.data) {\n                return;\n            }\n            if (event.data.penpal === MessageType.SynAck) {\n                const callSender = handleSynAckMessage(event);\n                if (callSender) {\n                    window.removeEventListener(NativeEventType.Message, handleMessage);\n                    stopConnectionTimeout();\n                    resolve(callSender);\n                }\n            }\n        };\n        window.addEventListener(NativeEventType.Message, handleMessage);\n        sendSynMessage();\n        onDestroy((error) => {\n            window.removeEventListener(NativeEventType.Message, handleMessage);\n            if (error) {\n                reject(error);\n            }\n        });\n    });\n    return {\n        promise,\n        destroy() {\n            // Don't allow consumer to pass an error into destroy.\n            destroy();\n        },\n    };\n};\n","export { default as connectToChild } from './parent/connectToChild';\nexport { default as connectToParent } from './child/connectToParent';\nexport { ErrorCode } from './enums';\n","//\n// Dotty makes it easy to programmatically access arbitrarily nested objects and\n// their properties.\n//\n\n//\n// `object` is an object, `path` is the path to the property you want to check\n// for existence of.\n//\n// `path` can be provided as either a `\"string.separated.with.dots\"` or as\n// `[\"an\", \"array\"]`.\n//\n// Returns `true` if the path can be completely resolved, `false` otherwise.\n//\n\nvar exists = (module.exports.exists = function exists(object, path) {\n  if (typeof path === \"string\") {\n    path = path.split(\".\");\n  }\n\n  if (!(path instanceof Array) || path.length === 0) {\n    return false;\n  }\n\n  path = path.slice();\n\n  var key = path.shift();\n\n  if (typeof object !== \"object\" || object === null) {\n    return false;\n  }\n\n  if (path.length === 0) {\n    return Object.hasOwnProperty.apply(object, [key]);\n  } else {\n    return exists(object[key], path);\n  }\n});\n\n//\n// These arguments are the same as those for `exists`.\n//\n// The return value, however, is the property you're trying to access, or\n// `undefined` if it can't be found. This means you won't be able to tell\n// the difference between an unresolved path and an undefined property, so you\n// should not use `get` to check for the existence of a property. Use `exists`\n// instead.\n//\n\nvar get = (module.exports.get = function get(object, path) {\n  if (typeof path === \"string\") {\n    path = path.split(\".\");\n  }\n\n  if (!(path instanceof Array) || path.length === 0) {\n    return;\n  }\n\n  path = path.slice();\n\n  var key = path.shift();\n\n  if (typeof object !== \"object\" || object === null) {\n    return;\n  }\n\n  if (path.length === 0) {\n    return object[key];\n  }\n\n  if (path.length) {\n    return get(object[key], path);\n  }\n});\n\n//\n// Arguments are similar to `exists` and `get`, with the exception that path\n// components are regexes with some special cases. If a path component is `\"*\"`\n// on its own, it'll be converted to `/.*/`.\n//\n// The return value is an array of values where the key path matches the\n// specified criterion. If none match, an empty array will be returned.\n//\n// If an action function is specified, that action will be applied to each\n// match. Action params are value, parent and key.\n//\n\nvar search = (module.exports.search = function search(object, path, action) {\n  if (typeof path === \"string\") {\n    path = path.split(\".\");\n  }\n\n  if (!(path instanceof Array) || path.length === 0) {\n    return;\n  }\n\n  path = path.slice();\n\n  var key = path.shift();\n\n  if (typeof object !== \"object\" || object === null) {\n    return;\n  }\n\n  if (key === \"*\") {\n    key = \".*\";\n  }\n\n  if (typeof key === \"string\") {\n    key = new RegExp(key);\n  }\n\n  if (path.length === 0) {\n    return Object.keys(object)\n      .filter(key.test.bind(key))\n      .map(function (k) {\n        var value = object[k];\n        if (action) {\n          action(value, object, k);\n        }\n        return value;\n      });\n  } else {\n    return Array.prototype.concat.apply(\n      [],\n      Object.keys(object)\n        .filter(key.test.bind(key))\n        .map(function (k) {\n          return search(object[k], path, action);\n        })\n    );\n  }\n});\n\n//\n// Perform a search and remove the matched keys.\n// The return value is the same object argument with modifications.\n//\n\nvar removeSearch = (module.exports.removeSearch = function removeSearch(\n  object,\n  path\n) {\n  search(object, path, function (value, object, key) {\n    delete object[key];\n  });\n  return object;\n});\n\n//\n// The first two arguments for `put` are the same as `exists` and `get`.\n//\n// The third argument is a value to `put` at the `path` of the `object`.\n// Objects in the middle will be created if they don't exist, or added to if\n// they do. If a value is encountered in the middle of the path that is *not*\n// an object, it will not be overwritten.\n//\n// The return value is `true` in the case that the value was `put`\n// successfully, or `false` otherwise.\n//\n\nvar put = (module.exports.put = function put(object, path, value) {\n  if (typeof path === \"string\") {\n    path = path.split(\".\");\n  }\n\n  if (!(path instanceof Array) || path.length === 0) {\n    return false;\n  }\n\n  path = path.slice();\n\n  var key = path.shift();\n\n  if (typeof object !== \"object\" || object === null || key === \"__proto__\") {\n    return false;\n  }\n  if (path.length === 0) {\n    object[key] = value;\n  } else {\n    if (typeof object[key] === \"undefined\") {\n      object[key] = {};\n    }\n\n    if (typeof object[key] !== \"object\" || object[key] === null) {\n      return false;\n    }\n\n    return put(object[key], path, value);\n  }\n});\n\n//\n// `remove` is like `put` in reverse!\n//\n// The return value is `true` in the case that the value existed and was removed\n// successfully, or `false` otherwise.\n//\n\nvar remove = (module.exports.remove = function remove(object, path, value) {\n  if (typeof path === \"string\") {\n    path = path.split(\".\");\n  }\n\n  if (!(path instanceof Array) || path.length === 0) {\n    return false;\n  }\n\n  path = path.slice();\n\n  var key = path.shift();\n\n  if (typeof object !== \"object\" || object === null) {\n    return false;\n  }\n\n  if (path.length === 0) {\n    if (!Object.hasOwnProperty.call(object, key)) {\n      return false;\n    }\n\n    delete object[key];\n\n    return true;\n  } else {\n    return remove(object[key], path, value);\n  }\n});\n\n//\n// `deepKeys` creates a list of all possible key paths for a given object.\n//\n// The return value is always an array, the members of which are paths in array\n// format. If you want them in dot-notation format, do something like this:\n//\n// ```js\n// dotty.deepKeys(obj).map(function(e) {\n//   return e.join(\".\");\n// });\n// ```\n//\n// *Note: this will probably explode on recursive objects. Be careful.*\n//\n\nvar deepKeys = (module.exports.deepKeys = function deepKeys(\n  object,\n  options,\n  prefix\n) {\n  options = options || {};\n\n  if (typeof prefix === \"undefined\") {\n    prefix = [];\n  }\n\n  var keys = [];\n\n  for (var k in object) {\n    if (!Object.hasOwnProperty.call(object, k)) {\n      continue;\n    }\n\n    if (!options.leavesOnly || typeof object[k] !== \"object\") {\n      keys.push(prefix.concat([k]));\n    }\n\n    if (typeof object[k] === \"object\" && object[k] !== null) {\n      keys = keys.concat(\n        deepKeys(\n          object[k],\n          { leavesOnly: options.leavesOnly },\n          prefix.concat([k])\n        )\n      );\n    }\n  }\n\n  if (options.asStrings) {\n    keys = keys.map(function (e) {\n      return e.join(\".\");\n    });\n  }\n\n  return keys;\n});\n","import Settings from './settings'\n\ninterface Setting<T> {\n  value: T\n  setValue: (newValue: T) => void\n  applySetting?: () => void\n}\n\nclass Setting<T> {\n  constructor(public value: T) {\n    this.setValue = function setValue(newValue: T): void {\n      this.value = newValue\n      if (typeof this['applySetting'] === 'function') {\n        this.applySetting()\n      }\n    }\n  }\n}\n\nexport default Setting\n","import App from '../App'\nimport Setting from './Setting'\n\ninterface Settings {\n  showLogoOnStartup: Setting<boolean>\n  timeOffset: Setting<number>\n  colors: {\n    default: {\n      clock: Setting<string>\n      background: Setting<string>\n      progressBackground: Setting<string>\n      progressFilled: Setting<string>\n      progressTip: Setting<string>\n    }\n    alternative: {\n      clock: Setting<string>\n      background: Setting<string>\n      progressBackground: Setting<string>\n      progressFilled: Setting<string>\n      progressTip: Setting<string>\n    }\n  }\n  appearance: {\n    showProgressBar: Setting<boolean>\n    showProgressBarTip: Setting<boolean>\n    displayOffsetedTime: Setting<boolean>\n  }\n}\n\nexport interface SettingsValues {\n  showLogoOnStartup: boolean\n  timeOffset: number\n  colors: {\n    default: {\n      clock: string\n      background: string\n      progressBackground: string\n      progressFilled: string\n      progressTip: string\n    }\n    alternative: {\n      clock: string\n      background: string\n      progressBackground: string\n      progressFilled: string\n      progressTip: string\n    }\n  }\n  appearance: {\n    showProgressBar: boolean\n    showProgressBarTip: boolean\n    displayOffsetedTime: boolean\n  }\n}\n\nfunction setCSSVariable(key: string, value: string) {\n  document.documentElement.style.setProperty(`--${key}`, value)\n}\n\nclass Settings {\n  constructor(config: SettingsValues) {\n    this.showLogoOnStartup = {\n      ...new Setting(config.showLogoOnStartup),\n      applySetting() {\n        console.warn('missing implementation!')\n      }\n    }\n\n    this.timeOffset = {\n      ...new Setting(config.timeOffset),\n      applySetting() {\n        window.app.timeOffset = this.value\n      }\n    }\n\n    this.colors = {\n      default: {\n        background: {\n          ...new Setting(config.colors.default.background),\n          applySetting() {\n            setCSSVariable('default-background-color', this.value)\n          }\n        },\n        clock: {\n          ...new Setting(config.colors.default.clock),\n          applySetting() {\n            setCSSVariable('default-clock-color', this.value)\n          }\n        },\n        progressBackground: {\n          ...new Setting(config.colors.default.progressBackground),\n          applySetting() {\n            setCSSVariable('default-progress-background-color', this.value)\n          }\n        },\n        progressFilled: {\n          ...new Setting(config.colors.default.progressFilled),\n          applySetting() {\n            setCSSVariable('default-progress-filled-color', this.value)\n          }\n        },\n        progressTip: {\n          ...new Setting(config.colors.default.progressTip),\n          applySetting() {\n            setCSSVariable('default-progress-tip-color', this.value)\n          }\n        }\n      },\n      alternative: {\n        background: {\n          ...new Setting(config.colors.alternative.background),\n          applySetting() {\n            setCSSVariable('alternative-background-color', this.value)\n          }\n        },\n        clock: {\n          ...new Setting(config.colors.alternative.clock),\n          applySetting() {\n            setCSSVariable('alternative-clock-color', this.value)\n          }\n        },\n        progressBackground: {\n          ...new Setting(config.colors.alternative.progressBackground),\n          applySetting() {\n            setCSSVariable('alternative-progress-background-color', this.value)\n          }\n        },\n        progressFilled: {\n          ...new Setting(config.colors.alternative.progressFilled),\n          applySetting() {\n            setCSSVariable('alternative-progress-filled-color', this.value)\n          }\n        },\n        progressTip: {\n          ...new Setting(config.colors.alternative.progressTip),\n          applySetting() {\n            setCSSVariable('alternative-progress-tip-color', this.value)\n          }\n        }\n      }\n    }\n\n    this.appearance = {\n      showProgressBar: {\n        ...new Setting(config.appearance.showProgressBar),\n        applySetting() {\n          if (this.value == false)\n            (\n              document.querySelector('.progress-container') as HTMLDivElement\n            ).style.setProperty('display', 'none')\n          else\n            (\n              document.querySelector('.progress-container') as HTMLDivElement\n            ).style.setProperty('display', 'initial')\n        }\n      },\n      showProgressBarTip: {\n        ...new Setting(config.appearance.showProgressBarTip),\n        applySetting() {\n          if (this.value == false)\n            (\n              document.querySelector('.progress-filled') as HTMLDivElement\n            ).style.setProperty('border-right-style', 'none')\n          else\n            (\n              document.querySelector('.progress-filled') as HTMLDivElement\n            ).style.setProperty('border-right-style', 'solid')\n        }\n      },\n      displayOffsetedTime: {\n        ...new Setting(config.appearance.displayOffsetedTime),\n        applySetting() {\n          window.app.iterate()\n        }\n      }\n    }\n  }\n}\n\nexport default Settings\n","module.exports={showLogoOnStartup:!0,timeOffset:0,colors:{default:{clock:\"#ffffff\",background:\"#000000\",progressBackground:\"#24264d\",progressFilled:\"#e8cf43\",progressTip:\"#5a62e8\"},alternative:{clock:\"#e8cf43\",background:\"#111111\",progressBackground:\"#24264d\",progressFilled:\"#e8cf43\",progressTip:\"#5a62e8\"}},appearance:{showProgressBar:!0,showProgressBarTip:!0,displayOffsetedTime:!0}};","import { connectToChild } from 'penpal' // @ts-ignore\nimport dotty from 'dotty'\n\nimport Settings from './settings'\n\nimport DEFAULT_SETTINGS from './default.json'\nimport Timetable from '../timetable'\n\ninterface Config {\n  settings: Settings\n}\n\nfunction getSettingsFromLocalStorage() {\n  try {\n    const entry = localStorage.getItem('settings')\n    if (typeof entry != 'string')\n      throw new TypeError('\"settings\" entry is not string')\n    return JSON.parse(entry)\n  } catch {\n    return null\n  }\n}\n\nfunction validateSettings(settings: any): boolean {\n  if (typeof settings != 'object') {\n    return false\n  }\n\n  // I hate this btw\n\n  if (typeof settings?.showLogoOnStartup != 'boolean') return false\n  if (typeof settings?.timeOffset != 'number') return false\n  if (typeof settings?.colors != 'object') return false\n  if (typeof settings?.colors.default != 'object') return false\n  if (typeof settings?.colors.default.clock != 'string') return false\n  if (typeof settings?.colors.default.background != 'string') return false\n  if (typeof settings?.colors.default.progressBackground != 'string')\n    return false\n  if (typeof settings?.colors.default.progressFilled != 'string') return false\n  if (typeof settings?.colors.default.progressTip != 'string') return false\n  if (typeof settings?.colors.alternative != 'object') return false\n  if (typeof settings?.colors.alternative.clock != 'string') return false\n  if (typeof settings?.colors.alternative.background != 'string') return false\n  if (typeof settings?.colors.alternative.progressBackground != 'string')\n    return false\n  if (typeof settings?.colors.alternative.progressFilled != 'string')\n    return false\n  if (typeof settings?.colors.alternative.progressTip != 'string') return false\n  if (typeof settings?.appearance != 'object') return false\n  if (typeof settings?.appearance.showProgressBar != 'boolean') return false\n  if (typeof settings?.appearance.showProgressBarTip != 'boolean') return false\n  if (typeof settings?.appearance.displayOffsetedTime != 'boolean') return false\n\n  return true\n}\n\nclass Config {\n  timetable: Timetable\n  constructor(timetable: Timetable) {\n    this.timetable = timetable\n\n    const settingsFromLocalStorage = getSettingsFromLocalStorage()\n    if (validateSettings(settingsFromLocalStorage)) {\n      this.settings = new Settings(settingsFromLocalStorage)\n    } else {\n      console.log('Using default settings')\n      this.settings = new Settings(DEFAULT_SETTINGS)\n    }\n\n    setTimeout(this.applySettings.bind(this), 0) // this line would be executed while constructor for App hasn't ended, resulting in errors while trying to modify App object.\n\n    this.connectToIframe()\n  }\n\n  private applySettings(): void {\n    const iterate = (obj: object) => {\n      Object.entries(obj).forEach(([key, value]) => {\n        if (typeof value['applySetting'] == 'function') {\n          value.applySetting()\n        } else {\n          iterate(value)\n        }\n      })\n    }\n\n    iterate(this.settings)\n  }\n\n  private saveSettingsToLocalStorage() {\n    // I hate this too\n    localStorage.setItem(\n      'settings',\n      JSON.stringify({\n        showLogoOnStartup: this.settings.showLogoOnStartup.value,\n        timeOffset: this.settings.timeOffset.value,\n        colors: {\n          default: {\n            clock: this.settings.colors.default.clock.value,\n            background: this.settings.colors.default.background.value,\n            progressBackground:\n              this.settings.colors.default.progressBackground.value,\n            progressFilled: this.settings.colors.default.progressFilled.value,\n            progressTip: this.settings.colors.default.progressTip.value\n          },\n          alternative: {\n            clock: this.settings.colors.alternative.clock.value,\n            background: this.settings.colors.alternative.background.value,\n            progressBackground:\n              this.settings.colors.alternative.progressBackground.value,\n            progressFilled:\n              this.settings.colors.alternative.progressFilled.value,\n            progressTip: this.settings.colors.alternative.progressTip.value\n          }\n        },\n        appearance: {\n          showProgressBar: this.settings.appearance.showProgressBar.value,\n          showProgressBarTip: this.settings.appearance.showProgressBarTip.value,\n          displayOffsetedTime:\n            this.settings.appearance.displayOffsetedTime.value\n        }\n      })\n    )\n  }\n\n  private connectToIframe() {\n    const iframe = document.querySelector(\n      'iframe#preferences'\n    ) as HTMLIFrameElement\n\n    connectToChild({\n      iframe,\n      methods: {\n        setValue: (path: string, newValue: any) => {\n          console.log('set', {\n            path,\n            newValue\n          })\n          dotty.get(this.settings, path).setValue(newValue)\n          this.saveSettingsToLocalStorage()\n        },\n        getValue: (path: string) => {\n          console.log('get', { path })\n          return dotty.get(this.settings, path).value\n        },\n        close: () => {\n          ;(iframe.parentElement as HTMLDivElement).classList.add('d-none')\n        },\n        restoreDefaultConfig: () => {\n          localStorage.removeItem('settings')\n          window.location.reload()\n        },\n        getTimetable: ()=> {\n          return this.timetable.lessons\n        },\n        setTimetable: (timetable: any)=> {\n          this.timetable.load(timetable)\n        },\n        restoreDefaultTimetable: ()=> {\n          this.timetable.restoreDeafultTimetable()\n        }\n      }\n    })\n  }\n}\n\nexport default Config\n","module.exports={currentVersion:\"v1.5\"};","import { currentVersion } from './currentVersion.json'\n\nclass Autoupdater {\n  URL = new URL('VERSION.txt', window.location.origin)\n\n  constructor() {\n    if (this.URL.hostname != 'localhost')\n      setInterval(this.checkForUpdates.bind(this), 3600 * 1000)\n  }\n\n  public checkForUpdates() {\n    fetch(this.URL.href, { cache: 'no-store' })\n      .then((response) => response.text())\n      .then((latestVersion) => {\n        if (latestVersion.trim() != currentVersion.trim()) this.reloadPage()\n      })\n  }\n\n  public reloadPage() {\n    window.location.reload()\n  }\n}\n\nexport default Autoupdater\n","import Timetable from './timetable'\nimport DOM from './dom'\nimport { DOMUpdate } from './dom'\nimport Info from './info'\nimport Config from './config'\nimport Autoupdater from './autoupdater'\n\ninterface App {\n  timetable: Timetable\n  dom: DOM\n  info: Info\n  config: Config\n  autoupdater: Autoupdater\n  loopInterval: number\n  timeOffset: number\n}\n\nfunction secondsSinceMidnight(): number {\n  return (<any>new Date() - <any>new Date().setHours(0, 0, 0, 0)) / 1000\n}\n\nclass App {\n  constructor() {\n    this.timetable = new Timetable()\n    this.dom = new DOM()\n    this.info = new Info(this.timetable)\n    this.config = new Config(this.timetable)\n    this.autoupdater = new Autoupdater()\n\n    this.timeOffset = 0\n\n    setTimeout(this.iterate.bind(this), 1)\n    this.loopInterval = setInterval(this.loop.bind(this), 1000)\n  }\n\n  private _debugSetTime(time: string) {\n    var [hours, minutes]: any[] = time.split(':')\n    hours = parseInt(hours)\n    minutes = parseInt(minutes)\n\n    const targetTime = hours * 60 * 60 + minutes * 60\n\n    this.timeOffset = targetTime - secondsSinceMidnight()\n  }\n\n  private getTime(): number {\n    return (secondsSinceMidnight() + this.timeOffset / 1000) % 86400\n  }\n\n  /**\n   *\n   * @returns Time not affected by timeOffset config.\n   */\n  private getRealTime(): number {\n    return secondsSinceMidnight()\n  }\n\n  private loop(): void {\n    /* @ts-ignore */\n    if (this._debugFastForward) {\n      /* @ts-ignore */\n      this.timeOffset += this._debugFastForward\n    }\n\n    const time = this.getTime()\n\n    var DOMUpdate: DOMUpdate = {}\n\n    const displayedTime = this.config.settings.appearance.displayOffsetedTime\n      .value\n      ? time\n      : this.getRealTime()\n\n    DOMUpdate.hours = Math.floor(displayedTime / 3600)\n    DOMUpdate.minutes = Math.floor((displayedTime / 60) % 60)\n      .toString()\n      .padStart(2, '0')\n\n    DOMUpdate.progress = this.timetable.getProgress(time)\n\n    DOMUpdate.info = this.info.generate(time)\n\n    DOMUpdate.theme = this.timetable.onBreak(time) ? 'alternative' : 'default'\n\n    this.dom.update(DOMUpdate)\n  }\n\n  /**\n   * Reruns main loop (mostly to apply updates to config)\n   */\n  public iterate(): void {\n    this.loop()\n  }\n}\n\nexport default App\n","import './style.less'\n\nimport App from './App'\n\ndeclare global {\n  interface Window {\n    app: App\n  }\n}\n\nwindow.app = new App()\n"]}